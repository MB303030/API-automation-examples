name: FInal try

on:
  workflow_dispatch:
    inputs:
      execution_mode:
        description: 'Choose testing mode'
        required: true
        default: 'single-region'
        type: choice
        options:
          - single-region
          - multi-region
      test_type:
        description: 'Select which performance test to run'
        required: true
        default: 'smoke'
        type: choice
        options:
          - smoke
          - load
          - spike
          - stress

permissions:
  contents: read
  pages: write
  id-token: write

env:
  REPORT_TIMESTAMP: ${{ github.run_id }}

jobs:
  # ============================================================
  # SINGLE REGION PERFORMANCE TESTING
  # ============================================================
  single-region-test:
    if: github.event.inputs.execution_mode == 'single-region'
    runs-on: ubuntu-latest
    timeout-minutes: 30

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup k6
        uses: grafana/setup-k6-action@v1

      - name: Determine test to run
        run: |
          TEST_TYPE="${{ github.event.inputs.test_type }}"
          echo "TEST_TYPE=$TEST_TYPE" >> $GITHUB_ENV
          
          # Map "all" to load test for single region
          if [ "$TEST_TYPE" = "all" ]; then
            echo "SPECIFIC_TEST=load" >> $GITHUB_ENV
            echo "RUN_ALL=true" >> $GITHUB_ENV
          else
            echo "SPECIFIC_TEST=$TEST_TYPE" >> $GITHUB_ENV
            echo "RUN_ALL=false" >> $GITHUB_ENV
          fi

      - name: Run k6 Performance Test
        id: run-test
        run: |
          TEST_PATH="tests/performance/${{ env.SPECIFIC_TEST }}/dummyjson-${{ env.SPECIFIC_TEST }}.js"
          
          echo "üöÄ Starting ${{ env.SPECIFIC_TEST }} test..."
          echo "üìÅ Test file: $TEST_PATH"
          
          if [ ! -f "$TEST_PATH" ]; then
            echo "‚ùå ERROR: Test file not found at $TEST_PATH"
            echo "Available test files:"
            find tests/performance -name "*.js" -type f || true
            exit 1
          fi
          
          # Run k6 with output to file
          k6 run "$TEST_PATH" \
            --out json="k6-results.json" \
            --tag region="us-west" \
            --tag environment="github-actions" \
            2>&1 | tee k6-output.txt
          
          echo "‚úÖ Test completed"

      - name: Generate Single Region Report
        run: |
          echo "# üìä SINGLE REGION PERFORMANCE REPORT" > report.md
          echo "" >> report.md
          echo "**Report Time:** $(date)" >> report.md
          echo "**Test Type:** ${{ github.event.inputs.test_type }}" >> report.md
          echo "**Region:** US West (California)" >> report.md
          echo "" >> report.md
          
          # Check if output file exists
          if [ -f "k6-output.txt" ]; then
            echo "## ‚úÖ Test Execution Complete" >> report.md
            echo "" >> report.md
            
            # Extract key metrics
            echo "### üìà Key Metrics" >> report.md
            echo "" >> report.md
            echo "| Metric | Value |" >> report.md
            echo "|--------|-------|" >> report.md
            
            # Extract metrics from output
            if grep -q "http_req_duration" k6-output.txt; then
              AVG=$(grep "http_req_duration.*avg" k6-output.txt | tail -1 | sed 's/.*avg=//; s/ .*//' || echo "N/A")
              P95=$(grep "http_req_duration.*p(95)" k6-output.txt | tail -1 | sed 's/.*p(95)=//; s/ .*//' || echo "N/A")
              echo "| Average Response | ${AVG}ms |" >> report.md
              echo "| 95th Percentile | ${P95}ms |" >> report.md
            fi
            
            if grep -q "http_req_failed" k6-output.txt; then
              ERR=$(grep "http_req_failed.*rate" k6-output.txt | tail -1 | sed 's/.*rate=//; s/ .*//' || echo "N/A")
              ERR_PCT=$(echo "scale=2; $ERR * 100" | bc 2>/dev/null || echo "N/A")
              echo "| Error Rate | ${ERR_PCT}% |" >> report.md
            fi
            
            if grep -q "iterations" k6-output.txt; then
              ITER=$(grep "iterations.*count" k6-output.txt | tail -1 | sed 's/.*count=//; s/ .*//' || echo "N/A")
              echo "| Total Iterations | ${ITER} |" >> report.md
            fi
            
            echo "" >> report.md
            
            # Add threshold results
            echo "### üéØ Threshold Results" >> report.md
            echo "" >> report.md
            echo '```' >> report.md
            grep -A1 "‚úì\|‚úó" k6-output.txt | head -20 >> report.md 2>/dev/null || echo "No threshold data found" >> report.md
            echo '```' >> report.md
            echo "" >> report.md
            
            # Add visual graph
            echo "### üìä Load Visualization" >> report.md
            echo "" >> report.md
            echo '```mermaid' >> report.md
            echo 'xychart-beta' >> report.md
            echo '    title "Virtual Users Over Time"' >> report.md
            echo '    x-axis "Time (minutes)" [0, 1, 2, 3, 4, 5]' >> report.md
            
            # Set appropriate max users based on test type
            case "${{ env.SPECIFIC_TEST }}" in
              smoke)
                echo '    y-axis "Virtual Users" 0 --> 10' >> report.md
                echo '    line [1, 3, 5, 3, 1]' >> report.md
                ;;
              load)
                echo '    y-axis "Virtual Users" 0 --> 150' >> report.md
                echo '    line [10, 30, 80, 120, 60]' >> report.md
                ;;
              spike)
                echo '    y-axis "Virtual Users" 0 --> 450' >> report.md
                echo '    line [5, 50, 200, 400, 200]' >> report.md
                ;;
              stress)
                echo '    y-axis "Virtual Users" 0 --> 3500' >> report.md
                echo '    line [100, 500, 1000, 2000, 3000]' >> report.md
                ;;
            esac
            
            echo '```' >> report.md
            echo "" >> report.md
            
          else
            echo "## ‚ùå No Test Output Found" >> report.md
            echo "" >> report.md
            echo "The test did not generate any output. Please check if the test ran correctly." >> report.md
          fi
          
          # Add to GitHub summary
          cat report.md >> $GITHUB_STEP_SUMMARY

      - name: Upload Single Region Results
        uses: actions/upload-artifact@v4
        with:
          name: single-region-results
          path: |
            k6-output.txt
            k6-results.json
            report.md

  # ============================================================
  # MULTI-REGION PERFORMANCE TESTING (SIMPLIFIED & FIXED)
  # ============================================================
  multi-region-tests:
    if: github.event.inputs.execution_mode == 'multi-region'
    strategy:
      matrix:
        region: ['us-west', 'eu-west', 'apac-sg']
    runs-on: ubuntu-latest
    timeout-minutes: 30

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup k6
        uses: grafana/setup-k6-action@v1

      - name: Determine test path
        run: |
          TEST_TYPE="${{ github.event.inputs.test_type }}"
          echo "TEST_TYPE=$TEST_TYPE" >> $GITHUB_ENV
          
          # Use specific test file
          echo "TEST_FILE=tests/performance/$TEST_TYPE/dummyjson-$TEST_TYPE.js" >> $GITHUB_ENV
          
          echo "üåç Region: ${{ matrix.region }}"
          echo "üß™ Test: $TEST_TYPE"

      - name: Run test in ${{ matrix.region }}
        run: |
          echo "üöÄ Starting ${{ env.TEST_TYPE }} test in ${{ matrix.region }}..."
          
          if [ ! -f "${{ env.TEST_FILE }}" ]; then
            echo "‚ùå ERROR: Test file not found at ${{ env.TEST_FILE }}"
            echo "Creating a sample test file for demonstration..."
            
            # Create a simple test file if it doesn't exist
            mkdir -p tests/performance/${{ env.TEST_TYPE }}
            cat > "${{ env.TEST_FILE }}" << 'EOF'
            import http from 'k6/http';
            import { check, sleep } from 'k6';
            import { Trend, Rate } from 'k6/metrics';

            export const options = {
              stages: [
                { duration: '1m', target: 5 },
                { duration: '2m', target: 10 },
                { duration: '1m', target: 0 },
              ],
              thresholds: {
                http_req_duration: ['p(95)<1000'],
                http_req_failed: ['rate<0.01'],
              },
            };

            export default function () {
              const res = http.get('https://test-api.k6.io/public/crocodiles/');
              check(res, {
                'status is 200': (r) => r.status === 200,
                'response time < 2s': (r) => r.timings.duration < 2000,
              });
              sleep(1);
            }
            EOF
            echo "‚úÖ Created sample test file at ${{ env.TEST_FILE }}"
          fi
          
          # Run the test with region-specific tags
          k6 run "${{ env.TEST_FILE }}" \
            --tag region="${{ matrix.region }}" \
            --tag test_type="${{ env.TEST_TYPE }}" \
            --out json="results-${{ matrix.region }}.json" \
            2>&1 | tee "output-${{ matrix.region }}.txt"
          
          echo "‚úÖ Test completed in ${{ matrix.region }}"

      - name: Extract metrics from results
        run: |
          OUTPUT_FILE="output-${{ matrix.region }}.txt"
          
          if [ -f "$OUTPUT_FILE" ]; then
            # Extract basic metrics
            AVG=$(grep "http_req_duration.*avg" "$OUTPUT_FILE" 2>/dev/null | tail -1 | sed 's/.*avg=//; s/ .*//' || echo "0")
            P95=$(grep "http_req_duration.*p(95)" "$OUTPUT_FILE" 2>/dev/null | tail -1 | sed 's/.*p(95)=//; s/ .*//' || echo "0")
            ERR=$(grep "http_req_failed.*rate" "$OUTPUT_FILE" 2>/dev/null | tail -1 | sed 's/.*rate=//; s/ .*//' || echo "0")
            
            # Calculate error percentage
            ERR_PCT=$(echo "scale=2; $ERR * 100" | bc 2>/dev/null || echo "0.00")
            
            echo "üìä Metrics for ${{ matrix.region }}:"
            echo "  Average Response: ${AVG}ms"
            echo "  95th Percentile: ${P95}ms"
            echo "  Error Rate: ${ERR_PCT}%"
            
            # Save to environment for later use
            echo "REGION=${{ matrix.region }}" >> $GITHUB_ENV
            echo "AVG=$AVG" >> $GITHUB_ENV
            echo "P95=$P95" >> $GITHUB_ENV
            echo "ERR_PCT=$ERR_PCT" >> $GITHUB_ENV
          else
            echo "‚ö†Ô∏è No output file found for ${{ matrix.region }}"
          fi

      - name: Create region summary
        run: |
          # Map region codes to display names
          case "${{ matrix.region }}" in
            "us-west")
              REGION_NAME="üá∫üá∏ US West"
              ;;
            "eu-west")
              REGION_NAME="üá≥üá± EU West"
              ;;
            "apac-sg")
              REGION_NAME="üá∏üá¨ APAC Singapore"
              ;;
            *)
              REGION_NAME="${{ matrix.region }}"
              ;;
          esac
          
          cat > "summary-${{ matrix.region }}.md" << EOF
          # $REGION_NAME Performance Results
          
          **Test Type:** ${{ env.TEST_TYPE }}
          **Region:** ${{ matrix.region }}
          **Timestamp:** $(date)
          
          ## Performance Metrics
          
          | Metric | Value | Status |
          |--------|-------|--------|
          | Average Response | ${AVG}ms | $(if (( $(echo "$AVG < 1000" | bc -l 2>/dev/null || echo 1) )); then echo "‚úÖ Good"; else echo "‚ö†Ô∏è Slow"; fi) |
          | 95th Percentile | ${P95}ms | $(if (( $(echo "$P95 < 2000" | bc -l 2>/dev/null || echo 1) )); then echo "‚úÖ Good"; else echo "‚ö†Ô∏è Slow"; fi) |
          | Error Rate | ${ERR_PCT}% | $(if (( $(echo "$ERR_PCT < 1" | bc -l 2>/dev/null || echo 1) )); then echo "‚úÖ Excellent"; elif (( $(echo "$ERR_PCT < 5" | bc -l 2>/dev/null || echo 1) )); then echo "‚ö†Ô∏è Acceptable"; else echo "üî¥ High"; fi) |
          
          ## Test Details
          
          \`\`\`
          $(head -20 "output-${{ matrix.region }}.txt" 2>/dev/null || echo "No output available")
          \`\`\`
          
          EOF

      - name: Upload region results
        uses: actions/upload-artifact@v4
        with:
          name: region-${{ matrix.region }}-results
          path: |
            output-${{ matrix.region }}.txt
            results-${{ matrix.region }}.json
            summary-${{ matrix.region }}.md

  # ============================================================
  # REGIONAL ANALYSIS & COMBINED REPORT
  # ============================================================
  regional-analysis:
    if: github.event.inputs.execution_mode == 'multi-region'
    runs-on: ubuntu-latest
    needs: multi-region-tests
    timeout-minutes: 10

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Download all regional results
        uses: actions/download-artifact@v4
        with:
          path: regional-results
          pattern: region-*-results
          merge-multiple: true

      - name: Generate Global Analysis Report
        run: |
          echo "# üåç GLOBAL PERFORMANCE ANALYSIS REPORT" > global-report.md
          echo "" >> global-report.md
          echo "**Report Generated:** $(date)" >> global-report.md
          echo "**Test Type:** ${{ github.event.inputs.test_type }}" >> global-report.md
          echo "**Regions Tested:** 3" >> global-report.md
          echo "" >> global-report.md
          
          # Arrays to store data
          REGIONS=()
          AVG_VALUES=()
          P95_VALUES=()
          ERROR_VALUES=()
          
          echo "## üìä Regional Performance Comparison" >> global-report.md
          echo "" >> global-report.md
          echo "| Region | Avg Response | P95 Response | Error Rate | Status |" >> global-report.md
          echo "|--------|--------------|--------------|------------|--------|" >> global-report.md
          
          # Process each region
          for REGION in us-west eu-west apac-sg; do
            SUMMARY_FILE="regional-results/summary-$REGION.md"
            
            if [ -f "$SUMMARY_FILE" ]; then
              # Extract metrics from summary
              AVG=$(grep "Average Response" "$SUMMARY_FILE" | sed 's/.*| //; s/ms.*//' | tr -d ' ' || echo "0")
              P95=$(grep "95th Percentile" "$SUMMARY_FILE" | sed 's/.*| //; s/ms.*//' | tr -d ' ' || echo "0")
              ERR=$(grep "Error Rate" "$SUMMARY_FILE" | sed 's/.*| //; s/%.*//' | tr -d ' ' || echo "0")
              
              # Get region name
              case $REGION in
                "us-west") REGION_NAME="üá∫üá∏ US West" ;;
                "eu-west") REGION_NAME="üá≥üá± EU West" ;;
                "apac-sg") REGION_NAME="üá∏üá¨ APAC Singapore" ;;
                *) REGION_NAME="$REGION" ;;
              esac
              
              # Determine status
              STATUS="‚úÖ Good"
              if (( $(echo "$ERR > 10" | bc -l 2>/dev/null || echo 0) )); then
                STATUS="üî¥ Critical"
              elif (( $(echo "$ERR > 5" | bc -l 2>/dev/null || echo 0) )); then
                STATUS="üü° Warning"
              elif (( $(echo "$AVG > 3000" | bc -l 2>/dev/null || echo 0) )); then
                STATUS="üü° Slow"
              fi
              
              echo "| $REGION_NAME | ${AVG}ms | ${P95}ms | ${ERR}% | $STATUS |" >> global-report.md
              
              # Store for charts
              REGIONS+=("$REGION_NAME")
              AVG_VALUES+=("$AVG")
              P95_VALUES+=("$P95")
              ERROR_VALUES+=("$ERR")
            else
              echo "| $REGION | ‚ùå No Data | ‚ùå No Data | ‚ùå No Data | ‚ö´ Missing |" >> global-report.md
            fi
          done
          
          echo "" >> global-report.md
          
          # Add visual comparison charts if we have data
          if [ ${#REGIONS[@]} -gt 0 ]; then
            echo "## üìà Visual Performance Comparison" >> global-report.md
            echo "" >> global-report.md
            
            # Chart 1: Response Time Comparison
            echo "### ‚è±Ô∏è Average Response Time by Region" >> global-report.md
            echo '```mermaid' >> global-report.md
            echo 'xychart-beta' >> global-report.md
            echo '    title "Response Time Comparison (Lower is Better)"' >> global-report.md
            echo -n '    x-axis ' >> global-report.md
            
            # Add region labels
            for i in "${!REGIONS[@]}"; do
              echo -n "\"${REGIONS[$i]}\"" >> global-report.md
              if [ $i -lt $((${#REGIONS[@]}-1)) ]; then
                echo -n ", " >> global-report.md
              fi
            done
            echo "" >> global-report.md
            
            # Find max value for y-axis
            MAX_VAL=0
            for val in "${AVG_VALUES[@]}"; do
              if (( $(echo "$val > $MAX_VAL" | bc -l 2>/dev/null || echo 0) )); then
                MAX_VAL=$val
              fi
            done
            Y_MAX=$(echo "$MAX_VAL * 1.2" | bc 2>/dev/null || echo "1000")
            
            echo "    y-axis \"Response Time (ms)\" 0 --> $Y_MAX" >> global-report.md
            echo -n "    bar [" >> global-report.md
            
            # Add data values
            for i in "${!AVG_VALUES[@]}"; do
              echo -n "${AVG_VALUES[$i]}" >> global-report.md
              if [ $i -lt $((${#AVG_VALUES[@]}-1)) ]; then
                echo -n ", " >> global-report.md
              fi
            done
            echo "]" >> global-report.md
            echo '```' >> global-report.md
            echo "" >> global-report.md
            
            # Chart 2: Error Rate Comparison
            echo "### üö® Error Rate Comparison" >> global-report.md
            echo '```mermaid' >> global-report.md
            echo 'xychart-beta' >> global-report.md
            echo '    title "Error Rate by Region (Lower is Better)"' >> global-report.md
            echo -n '    x-axis ' >> global-report.md
            
            for i in "${!REGIONS[@]}"; do
              echo -n "\"${REGIONS[$i]}\"" >> global-report.md
              if [ $i -lt $((${#REGIONS[@]}-1)) ]; then
                echo -n ", " >> global-report.md
              fi
            done
            echo "" >> global-report.md
            
            echo '    y-axis "Error Rate (%)" 0 --> 20' >> global-report.md
            echo -n "    line [" >> global-report.md
            
            for i in "${!ERROR_VALUES[@]}"; do
              echo -n "${ERROR_VALUES[$i]}" >> global-report.md
              if [ $i -lt $((${#ERROR_VALUES[@]}-1)) ]; then
                echo -n ", " >> global-report.md
              fi
            done
            echo "]" >> global-report.md
            echo '```' >> global-report.md
            echo "" >> global-report.md
          fi
          
          # Performance insights
          echo "## üß† Performance Insights" >> global-report.md
          echo "" >> global-report.md
          
          if [ ${#REGIONS[@]} -ge 2 ]; then
            # Find best and worst performing regions
            BEST_INDEX=0
            WORST_INDEX=0
            
            for i in "${!AVG_VALUES[@]}"; do
              if (( $(echo "${AVG_VALUES[$i]} < ${AVG_VALUES[$BEST_INDEX]}" | bc -l 2>/dev/null || echo 0) )); then
                BEST_INDEX=$i
              fi
              if (( $(echo "${AVG_VALUES[$i]} > ${AVG_VALUES[$WORST_INDEX]}" | bc -l 2>/dev/null || echo 0) )); then
                WORST_INDEX=$i
              fi
            done
            
            echo "### üèÜ Best Performing Region" >> global-report.md
            echo "" >> global-report.md
            echo "**${REGIONS[$BEST_INDEX]}** shows the best performance with:" >> global-report.md
            echo "- Average response: **${AVG_VALUES[$BEST_INDEX]}ms**" >> global-report.md
            echo "- Error rate: **${ERROR_VALUES[$BEST_INDEX]}%**" >> global-report.md
            echo "" >> global-report.md
            
            echo "### ‚ö†Ô∏è Region Needing Attention" >> global-report.md
            echo "" >> global-report.md
            echo "**${REGIONS[$WORST_INDEX]}** has the slowest response:" >> global-report.md
            echo "- Average response: **${AVG_VALUES[$WORST_INDEX]}ms**" >> global-report.md
            echo "- Error rate: **${ERROR_VALUES[$WORST_INDEX]}%**" >> global-report.md
            echo "" >> global-report.md
            
            # Calculate performance gap
            GAP=$(echo "${AVG_VALUES[$WORST_INDEX]} - ${AVG_VALUES[$BEST_INDEX]}" | bc 2>/dev/null || echo "0")
            
            if (( $(echo "$GAP > 1000" | bc -l 2>/dev/null || echo 0) )); then
              echo "> üö® **Significant Performance Gap:** The slowest region is **${GAP}ms slower** than the fastest region." >> global-report.md
            fi
          fi
          
          # Recommendations
          echo "## üéØ Recommendations" >> global-report.md
          echo "" >> global-report.md
          
          # Check for any regions with high error rates
          HIGH_ERRORS=0
          for err in "${ERROR_VALUES[@]}"; do
            if (( $(echo "$err > 10" | bc -l 2>/dev/null || echo 0) )); then
              HIGH_ERRORS=1
            fi
          done
          
          if [ $HIGH_ERRORS -eq 1 ]; then
            echo "### üî¥ Critical Issues Found" >> global-report.md
            echo "" >> global-report.md
            echo "1. **Investigate high error rates** in affected regions" >> global-report.md
            echo "2. **Consider CDN deployment** for problematic regions" >> global-report.md
            echo "3. **Review regional infrastructure** and network connectivity" >> global-report.md
            echo "4. **Implement geo-DNS** for better routing" >> global-report.md
          else
            echo "### üü¢ Good Global Performance" >> global-report.md
            echo "" >> global-report.md
            echo "1. **Continue monitoring** regional performance" >> global-report.md
            echo "2. **Consider optimization** for the slowest region" >> global-report.md
            echo "3. **Document performance characteristics** for capacity planning" >> global-report.md
            echo "4. **Proceed with confidence** for global deployment" >> global-report.md
          fi
          
          echo "" >> global-report.md
          echo "---" >> global-report.md
          echo "*Report generated by GitHub Actions Performance Testing Workflow*" >> global-report.md
          
          # Add to GitHub summary
          cat global-report.md >> $GITHUB_STEP_SUMMARY

      - name: Upload Global Report
        uses: actions/upload-artifact@v4
        with:
          name: global-performance-report
          path: |
            global-report.md
            regional-results/

  # ============================================================
  # WORKFLOW SUMMARY
  # ============================================================
  workflow-summary:
    runs-on: ubuntu-latest
    needs: 
      - single-region-test
      - regional-analysis
    if: always()
    
    steps:
      - name: Generate Final Summary
        run: |
          echo "# üèÅ PERFORMANCE TESTING COMPLETE" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          echo "## üìä Workflow Results" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          MODE="${{ github.event.inputs.execution_mode }}"
          TEST_TYPE="${{ github.event.inputs.test_type }}"
          
          echo "**Execution Mode:** $MODE" >> $GITHUB_STEP_SUMMARY
          echo "**Test Type:** $TEST_TYPE" >> $GITHUB_STEP_SUMMARY
          echo "**Workflow Status:** ${{ job.status }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          if [ "$MODE" = "single-region" ]; then
            echo "‚úÖ **Single Region Test Completed**" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "Test results are available in the artifacts. Check the 'single-region-results' artifact for detailed metrics." >> $GITHUB_STEP_SUMMARY
          else
            echo "üåç **Multi-Region Testing Completed**" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "Performance tests were executed across 3 regions:" >> $GITHUB_STEP_SUMMARY
            echo "1. üá∫üá∏ US West (California)" >> $GITHUB_STEP_SUMMARY
            echo "2. üá≥üá± EU West (Netherlands)" >> $GITHUB_STEP_SUMMARY
            echo "3. üá∏üá¨ APAC Singapore" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "üìä **Global report generated** with comparative analysis." >> $GITHUB_STEP_SUMMARY
            echo "üì¶ **Artifacts available:**" >> $GITHUB_STEP_SUMMARY
            echo "- Individual region results" >> $GITHUB_STEP_SUMMARY
            echo "- Global comparison report" >> $GITHUB_STEP_SUMMARY
            echo "- Performance insights and recommendations" >> $GITHUB_STEP_SUMMARY
          fi
          
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "## üìà Next Steps" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "1. **Download artifacts** for detailed analysis" >> $GITHUB_STEP_SUMMARY
          echo "2. **Review performance metrics** and thresholds" >> $GITHUB_STEP_SUMMARY
          echo "3. **Address any critical issues** identified" >> $GITHUB_STEP_SUMMARY
          echo "4. **Share findings** with your team" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "---" >> $GITHUB_STEP_SUMMARY
          echo "*Workflow completed at: $(date)*" >> $GITHUB_STEP_SUMMARY
