# .github/workflows/check-actual-files.yml
name: Check Actual Files

on: [workflow_dispatch]

jobs:
  check-files:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Examine endpoints.js
      run: |
        echo "=== FULL endpoints.js content ==="
        cat utils/config/endpoints.js
        echo ""
        echo "=== Line count ==="
        wc -l utils/config/endpoints.js
        echo ""
        echo "=== Checking syntax ==="
        
        # Try to parse as JavaScript
        if node -c utils/config/endpoints.js; then
          echo "✅ endpoints.js has valid JavaScript syntax"
        else
          echo "❌ endpoints.js has JavaScript syntax error"
        fi
        
        echo ""
        echo "=== Checking imports ==="
        grep -n "import" utils/config/endpoints.js
        
    - name: Examine env.js
      run: |
        echo "=== FULL env.js content ==="
        cat utils/config/env.js
        echo ""
        echo "=== Checking for k6 imports ==="
        if grep -q "k6" utils/config/env.js; then
          echo "❌ env.js mentions 'k6'"
          grep -n "k6" utils/config/env.js
        else
          echo "✅ env.js doesn't mention k6"
        fi
        
    - name: Create proper debug test
      run: |
        mkdir -p tests/debug
        
        cat > tests/debug/proper-debug.js << 'EOF'
        console.log('=== PROPER DEBUG START ===');
        
        // Method 1: Try to read the file directly
        console.log('\n1. Reading endpoints.js file:');
        try {
          const fileContent = open('../../../utils/config/endpoints.js');
          console.log('✅ File can be opened');
          console.log('First 500 characters:');
          console.log(fileContent.substring(0, 500));
          
          // Check for export statements
          if (fileContent.includes('export')) {
            console.log('✅ File contains export statements');
          } else {
            console.log('❌ File does not contain export statements');
          }
          
        } catch (e) {
          console.log('❌ Cannot open file:', e.message);
        }
        
        // Method 2: Try dynamic import
        console.log('\n2. Trying dynamic import:');
        try {
          const module = await import('../../../utils/config/endpoints.js');
          console.log('✅ Dynamic import successful!');
          console.log('Exported functions:', Object.keys(module));
        } catch (e) {
          console.log('❌ Dynamic import failed:');
          console.log('Error message:', e.message);
          console.log('Error name:', e.name);
          console.log('First line of stack:', e.stack ? e.stack.split('\n')[0] : 'No stack');
        }
        
        // Method 3: Try to import env.js directly
        console.log('\n3. Checking env.js:');
        try {
          const envContent = open('../../../utils/config/env.js');
          console.log('✅ env.js can be opened');
          console.log('First 200 chars:', envContent.substring(0, 200));
        } catch (e) {
          console.log('❌ Cannot open env.js:', e.message);
        }
        
        console.log('\n=== PROPER DEBUG END ===');
        export default function() {}
        EOF
    
    - name: Run debug test
      uses: grafana/setup-k6-action@v1
    
    - name: Execute debug
      run: |
        k6 run tests/debug/proper-debug.js
